<Page x:Class="Uno_Platform.Views.CartPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:components="using:Uno_Platform.Components"
      xmlns:models="using:Uno_Platform.Models"
      xmlns:converters="using:Uno_Platform.Converters"
      Background="{StaticResource BackgroundGradientBrush}">
  
  <Page.Resources>
    <!-- Page Enter Animation -->
    <Storyboard x:Name="PageEnterAnimation">
      <DoubleAnimation Storyboard.TargetName="ContentGrid"
                      Storyboard.TargetProperty="Opacity"
                      From="0"
                      To="1"
                      Duration="0:0:0.5">
        <DoubleAnimation.EasingFunction>
          <CubicEase EasingMode="EaseOut"/>
        </DoubleAnimation.EasingFunction>
      </DoubleAnimation>
    </Storyboard>
  </Page.Resources>

  <Grid x:Name="ContentGrid" Opacity="0">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Header with Acrylic Background -->
    <Border Grid.Row="0"
            Background="{StaticResource AcrylicBrush}"
            Padding="{StaticResource SpacingL}"
            BorderThickness="0,0,0,1"
            BorderBrush="{StaticResource BorderBrush}">
      <Grid ColumnDefinitions="Auto,*" ColumnSpacing="{StaticResource SpacingM}">
        <Button Grid.Column="0"
                Style="{StaticResource IconButtonStyle}"
                Background="{StaticResource SurfaceBrush}"
                Foreground="{StaticResource PrimaryBrush}"
                CornerRadius="{StaticResource BorderRadiusMedium}"
                Width="48"
                Height="48"
                Command="{x:Bind ViewModel.GoBackCommand}">
          <SymbolIcon Symbol="Back" FontSize="24"/>
        </Button>
        
        <StackPanel Grid.Column="1"
                   VerticalAlignment="Center">
          <TextBlock Text="ðŸ›’ Shopping Cart"
                  Style="{StaticResource Heading2Style}"
                    Foreground="{StaticResource TextPrimaryBrush}"/>
          <TextBlock Text="{x:Bind ViewModel.TotalItemsFormatted, Mode=OneWay}"
                    Style="{StaticResource SecondaryTextStyle}"
                    Margin="0,4,0,0"
                    Foreground="{StaticResource TextSecondaryBrush}"/>
        </StackPanel>
      </Grid>
    </Border>

    <!-- Cart Items -->
    <ScrollViewer Grid.Row="1" 
                  Padding="{StaticResource SpacingL}"
                  ZoomMode="Disabled"
                  VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Disabled">
      <Grid>
        <!-- Items List -->
        <ItemsControl ItemsSource="{x:Bind ViewModel.CartItems, Mode=OneWay}"
                     x:Name="CartItemsControl">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <StackPanel Spacing="{StaticResource SpacingL}"/>
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="models:CartItem">
              <components:CartItemCard CartItem="{x:Bind}"
                                      IncreaseQuantityCommand="{x:Bind ViewModel.UpdateQuantityCommand}"
                                      DecreaseQuantityCommand="{x:Bind ViewModel.UpdateQuantityCommand}"
                                      RemoveItemCommand="{x:Bind ViewModel.RemoveItemCommand}"/>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Empty State -->
        <Border x:Name="EmptyStateBorder"
                Background="{StaticResource AcrylicBrush}"
                Padding="{StaticResource SpacingXXL}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Center"
                CornerRadius="{StaticResource BorderRadiusXLarge}"
                BorderThickness="2"
                BorderBrush="{StaticResource BorderBrush}"
                Visibility="{x:Bind ViewModel.CartItems.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=Inverse}">
          <StackPanel Spacing="{StaticResource SpacingL}" HorizontalAlignment="Center">
            <TextBlock Text="ðŸ›’"
                      FontSize="96"
                      HorizontalAlignment="Center"
                      Opacity="0.6"/>
            <TextBlock Text="Your cart is empty"
                       Style="{StaticResource Heading2Style}"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="Add some amazing products to get started shopping!"
                       Style="{StaticResource SecondaryTextStyle}"
                      HorizontalAlignment="Center"
                      TextAlignment="Center"
                      TextWrapping="Wrap"
                      MaxWidth="400"/>
            <Button Content="ðŸ›ï¸ Browse Products"
                   Style="{StaticResource PrimaryButtonStyle}"
                   Margin="0,{StaticResource SpacingM},0,0"
                   Padding="32,16"
                   FontSize="{StaticResource FontSizeBody}"
                   FontWeight="SemiBold"
                   HorizontalAlignment="Center"
                   Command="{x:Bind ViewModel.ContinueShoppingCommand}"/>
          </StackPanel>
        </Border>
      </Grid>
    </ScrollViewer>

    <!-- Total and Checkout Panel - Large Clear Panel -->
    <Border Grid.Row="2"
            Background="{StaticResource AcrylicBrush}"
            Padding="{StaticResource SpacingXL}"
            Margin="{StaticResource SpacingL}"
            CornerRadius="{StaticResource BorderRadiusXLarge}"
            BorderThickness="2"
            BorderBrush="{StaticResource PrimaryBrush}">
      <Border.Effect>
        <!-- Shadow effect via Border -->
      </Border.Effect>
      
      <Grid>
        <!-- Shadow Border for depth -->
        <Border Background="#20000000"
               CornerRadius="{StaticResource BorderRadiusXLarge}"
               Margin="0,4,0,0"
               Opacity="0.3"/>
        
        <!-- Main Content -->
        <StackPanel Spacing="{StaticResource SpacingL}">
          
          <!-- Total Section -->
          <Border Background="{StaticResource PrimaryGradientBrush}"
                 Padding="{StaticResource SpacingXL}"
                 CornerRadius="{StaticResource BorderRadiusLarge}"
                 Margin="0,0,0,{StaticResource SpacingM}">
            <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto">
              
              <!-- Subtotal Row -->
              <TextBlock Grid.Row="0" Grid.Column="0"
                        Text="Subtotal:"
                        Style="{StaticResource Heading3Style}"
                        Foreground="White"
                        Opacity="0.9"
                        VerticalAlignment="Center"/>
              <TextBlock Grid.Row="0" Grid.Column="1"
                        Text="{x:Bind ViewModel.TotalPrice, Mode=OneWay, Converter={StaticResource PriceFormatConverter}}"
                        Style="{StaticResource Heading2Style}"
                        Foreground="White"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"/>
              
              <!-- Divider -->
              <Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                     Height="2"
                     Background="#60FFFFFF"
                     Margin="0,{StaticResource SpacingM},0,{StaticResource SpacingM}"
                     HorizontalAlignment="Stretch"/>
              
              <!-- Total Row -->
              <TextBlock Grid.Row="1" Grid.Column="0"
                    Text="Total:"
                    Style="{StaticResource Heading1Style}"
                    Foreground="White"
                        FontSize="28"
                        FontWeight="Bold"
                        VerticalAlignment="Center"/>
              <TextBlock Grid.Row="1" Grid.Column="1"
                        Text="{x:Bind ViewModel.TotalPrice, Mode=OneWay, Converter={StaticResource PriceFormatConverter}}"
                        Foreground="White"
                        FontSize="40"
                        FontWeight="Bold"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"/>
              
        </Grid>
          </Border>

          <!-- Checkout Button - Standout Style -->
          <Button Content="ðŸ’³ Proceed to Checkout"
               Style="{StaticResource PrimaryButtonStyle}"
                 FontSize="{StaticResource FontSizeH3}"
                 FontWeight="Bold"
                 Padding="32,20"
                 Height="64"
                 CornerRadius="{StaticResource BorderRadiusLarge}"
                 Background="{StaticResource AccentBrush}"
                 Foreground="White"
               Command="{x:Bind ViewModel.CheckoutCommand}"
                 IsEnabled="{x:Bind ViewModel.CartItems.Count, Mode=OneWay}"
                 Margin="0,{StaticResource SpacingS},0,0"/>

          <!-- Clear Cart Button -->
          <Button Content="ðŸ—‘ï¸ Clear Cart"
                 Style="{StaticResource SecondaryButtonStyle}"
                 FontSize="{StaticResource FontSizeSmall}"
                 FontWeight="SemiBold"
                 Padding="24,12"
                 Height="48"
                 CornerRadius="{StaticResource BorderRadiusMedium}"
                 Background="Transparent"
                 BorderBrush="{StaticResource ErrorBrush}"
                 BorderThickness="2"
                 Foreground="{StaticResource ErrorBrush}"
                 Command="{x:Bind ViewModel.ClearCartCommand}"
                 IsEnabled="{x:Bind ViewModel.CartItems.Count, Mode=OneWay}"
                 HorizontalAlignment="Center"
                 Margin="0,{StaticResource SpacingS},0,0"/>

      </StackPanel>
      </Grid>
    </Border>

    <!-- Loading Overlay -->
    <components:LoadingIndicator Grid.Row="1"
                                IsLoading="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                              Message="Loading cart..."/>
  </Grid>
</Page>
