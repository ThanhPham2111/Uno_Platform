<Page x:Class="Uno_Platform.Views.CheckoutPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Uno_Platform.Views"
      xmlns:vm="using:Uno_Platform.ViewModels"
      Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" 
                Background="{ThemeResource SystemAccentColor}"
                Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <Button Grid.Column="0"
                        Command="{x:Bind ViewModel.GoBackCommand}"
                        Style="{StaticResource GhostButtonStyle}"
                        Content="&#xE72B;" 
                        FontFamily="Segoe MDL2 Assets"
                        Foreground="White"
                        FontSize="20"
                        Margin="0,0,16,0"/>
                
                <TextBlock Grid.Column="1"
                           Text="Thanh toán"
                           FontSize="24"
                           FontWeight="SemiBold"
                           Foreground="White"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>

        <!-- Content -->
        <ScrollViewer Grid.Row="1" Padding="16">
            <Grid MaxWidth="1000" HorizontalAlignment="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <!-- Responsive layout: Stack on mobile, side-by-side on desktop (min-width 800) -->
                    <ColumnDefinition Width="Auto"/> 
                </Grid.ColumnDefinitions>
                
                <!-- Use VisualStateManager for responsive layout if needed, 
                     but for simplicity we'll use a StackPanel for now or a Grid with wrapping logic.
                     Here we assume a single column flow for mobile-first. -->
                
                <StackPanel Spacing="24">
                    
                    <!-- Section: Shipping Info -->
                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            Padding="24"
                            CornerRadius="12"
                            BorderThickness="1"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
                        <StackPanel Spacing="20">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <FontIcon Glyph="&#xE77B;" FontSize="24" Foreground="{ThemeResource SystemAccentColor}"/>
                                <TextBlock Text="Thông tin giao hàng"
                                           FontSize="20"
                                           FontWeight="SemiBold"/>
                            </StackPanel>
                            
                            <TextBox Header="Họ và tên"
                                     Text="{x:Bind ViewModel.CustomerName, Mode=TwoWay}"
                                     PlaceholderText="Nguyễn Văn A"
                                     FontSize="16"/>

                            <TextBox Header="Số điện thoại"
                                     Text="{x:Bind ViewModel.CustomerPhone, Mode=TwoWay}"
                                     PlaceholderText="0901234567"
                                     InputScope="TelephoneNumber"
                                     FontSize="16"/>

                            <TextBox Header="Địa chỉ nhận hàng"
                                     Text="{x:Bind ViewModel.CustomerAddress, Mode=TwoWay}"
                                     PlaceholderText="Số nhà, đường, phường/xã..."
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     MinHeight="80"
                                     FontSize="16"/>
                        </StackPanel>
                    </Border>

                    <!-- Section: Order Summary -->
                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            Padding="24"
                            CornerRadius="12"
                            BorderThickness="1"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
                        <StackPanel Spacing="20">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <FontIcon Glyph="&#xE7BF;" FontSize="24" Foreground="{ThemeResource SystemAccentColor}"/>
                                <TextBlock Text="Đơn hàng của bạn"
                                           FontSize="20"
                                           FontWeight="SemiBold"/>
                            </StackPanel>

                            <!-- Cart Items List -->
                            <ItemsControl ItemsSource="{x:Bind ViewModel.CartItems, Mode=OneWay}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,0,0,12">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <StackPanel Grid.Column="0" Spacing="4">
                                                <TextBlock Text="{Binding ProductName}"
                                                           FontWeight="Medium"
                                                           FontSize="16"
                                                           TextTrimming="CharacterEllipsis"/>
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <TextBlock Text="{Binding ProductPrice, Converter={StaticResource PriceFormatConverter}}"
                                                               Foreground="{ThemeResource SystemBaseMediumColor}"/>
                                                    <TextBlock Text="x" Foreground="{ThemeResource SystemBaseMediumColor}"/>
                                                    <TextBlock Text="{Binding Quantity}"
                                                               FontWeight="Bold"/>
                                                </StackPanel>
                                            </StackPanel>
                                            
                                            <TextBlock Grid.Column="1"
                                                       Text="{Binding TotalPrice, Converter={StaticResource PriceFormatConverter}}"
                                                       FontWeight="Bold"
                                                       VerticalAlignment="Center"/>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <MenuFlyoutSeparator/>

                            <!-- Total -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Tổng cộng"
                                           FontSize="18"
                                           FontWeight="Bold"/>
                                <TextBlock Grid.Column="1"
                                           Text="{x:Bind ViewModel.TotalPriceFormatted, Mode=OneWay}"
                                           FontSize="24"
                                           FontWeight="Bold"
                                           Foreground="{ThemeResource SystemAccentColor}"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Error Message -->
                    <InfoBar IsOpen="{x:Bind ViewModel.ErrorMessage, Converter={StaticResource StringToBooleanConverter}, Mode=OneWay}"
                             Severity="Error"
                             Message="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                             IsClosable="False"/>

                    <!-- Submit Button -->
                    <Button Command="{x:Bind ViewModel.SubmitOrderCommand}"
                            Style="{StaticResource AccentButtonStyle}"
                            HorizontalAlignment="Stretch"
                            Padding="0,16">
                        <Grid ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <ProgressRing Grid.Column="0"
                                          IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                                          Visibility="{x:Bind ViewModel.IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                                          Width="20" Height="20"
                                          Foreground="White"/>
                            <TextBlock Grid.Column="1" 
                                       Text="Xác nhận đặt hàng" 
                                       FontSize="18" 
                                       FontWeight="Bold"
                                       HorizontalAlignment="Center"/>
                        </Grid>
                    </Button>
                    
                </StackPanel>
            </Grid>
        </ScrollViewer>
    </Grid>
</Page>
