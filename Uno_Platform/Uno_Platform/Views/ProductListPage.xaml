<Page x:Class="Uno_Platform.Views.ProductListPage"
      x:Name="PageRoot"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:components="using:Uno_Platform.Components"
      xmlns:models="using:Uno_Platform.Models"
      xmlns:converters="using:Uno_Platform.Converters"
      Background="{StaticResource BackgroundGradientBrush}">
  
  <Page.Resources>
    <!-- Page Enter Animation -->
    <Storyboard x:Name="PageEnterAnimation">
      <DoubleAnimation Storyboard.TargetName="ContentGrid"
                      Storyboard.TargetProperty="Opacity"
                      From="0"
                      To="1"
                      Duration="0:0:0.5">
        <DoubleAnimation.EasingFunction>
          <CubicEase EasingMode="EaseOut"/>
        </DoubleAnimation.EasingFunction>
      </DoubleAnimation>
    </Storyboard>

    <!-- Card Stagger Animation Template -->
    <Storyboard x:Name="CardEnterAnimation" x:Key="CardEnterAnimation">
      <DoubleAnimation Storyboard.TargetProperty="Opacity"
                      From="0"
                      To="1"
                      Duration="0:0:0.4">
        <DoubleAnimation.EasingFunction>
          <CubicEase EasingMode="EaseOut"/>
        </DoubleAnimation.EasingFunction>
      </DoubleAnimation>
      <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                      From="30"
                      To="0"
                      Duration="0:0:0.4">
        <DoubleAnimation.EasingFunction>
          <CubicEase EasingMode="EaseOut"/>
        </DoubleAnimation.EasingFunction>
      </DoubleAnimation>
    </Storyboard>
  </Page.Resources>

  <Grid x:Name="ContentGrid" Opacity="0">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <!-- Search and Filter Section with Modern Design -->
    <Border Grid.Row="0"
            Background="{StaticResource AcrylicBrush}"
            Padding="{StaticResource SpacingL}"
            BorderThickness="0,0,0,1"
            BorderBrush="{StaticResource BorderBrush}">
      <StackPanel Spacing="{StaticResource SpacingM}">

        <!-- Search TextBox with Icon -->
        <Border Background="{StaticResource SurfaceBrush}"
                Padding="16"
                CornerRadius="{StaticResource BorderRadiusLarge}"
                BorderThickness="2"
                BorderBrush="{StaticResource BorderBrush}">
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
            <SymbolIcon Grid.Column="0"
                       Symbol="Find"
                       Foreground="{StaticResource PrimaryBrush}"
                       VerticalAlignment="Center"/>
            <TextBox Grid.Column="1"
                    Text="{x:Bind ViewModel.SearchKeyword, Mode=TwoWay}"
                    PlaceholderText="Search products by name, category..."
                    BorderThickness="0"
                    Background="Transparent"
                    FontSize="{StaticResource FontSizeBody}"
                    Foreground="{StaticResource TextPrimaryBrush}"/>
          </Grid>
        </Border>

        <!-- Price Filter Slider -->
        <Border Background="{StaticResource SurfaceBrush}"
                Padding="{StaticResource SpacingM}"
                CornerRadius="{StaticResource BorderRadiusLarge}"
                BorderThickness="2"
                BorderBrush="{StaticResource BorderBrush}">
          <StackPanel Spacing="{StaticResource SpacingM}">
            <TextBlock Text="Price Range"
                       Style="{StaticResource Heading3Style}"
                       Foreground="{StaticResource TextPrimaryBrush}"/>
            <Grid ColumnDefinitions="*,Auto,*" ColumnSpacing="16">
              <Border Grid.Column="0"
                     Background="{StaticResource PrimaryBrush}"
                     CornerRadius="{StaticResource BorderRadiusSmall}"
                     Padding="12,8"
                     HorizontalAlignment="Left">
                <StackPanel Orientation="Horizontal" Spacing="4">
                  <TextBlock Text="$"
                            Foreground="White"
                            FontWeight="Bold"
                            VerticalAlignment="Center"/>
                  <TextBlock Text="{x:Bind ViewModel.CurrentMinPriceFormatted, Mode=OneWay}"
                            Foreground="White"
                            FontWeight="Bold"
                            FontSize="{StaticResource FontSizeBody}"/>
                </StackPanel>
              </Border>
              
              <TextBlock Grid.Column="1"
                        Text="â€”"
                        FontSize="20"
                        Foreground="{StaticResource TextSecondaryBrush}"
                        VerticalAlignment="Center"/>
              
              <Border Grid.Column="2"
                     Background="{StaticResource PrimaryBrush}"
                     CornerRadius="{StaticResource BorderRadiusSmall}"
                     Padding="12,8"
                     HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal" Spacing="4">
                  <TextBlock Text="$"
                            Foreground="White"
                            FontWeight="Bold"
                            VerticalAlignment="Center"/>
                  <TextBlock Text="{x:Bind ViewModel.CurrentMaxPriceFormatted, Mode=OneWay}"
                            Foreground="White"
                            FontWeight="Bold"
                            FontSize="{StaticResource FontSizeBody}"/>
                </StackPanel>
              </Border>
            </Grid>
            
            <Slider Minimum="{x:Bind ViewModel.MinPrice, Mode=OneWay}"
                   Maximum="{x:Bind ViewModel.MaxPrice, Mode=OneWay}"
                   Value="{x:Bind ViewModel.CurrentMinPrice, Mode=TwoWay}"
                   TickFrequency="100"
                   TickPlacement="None"
                   Foreground="{StaticResource PrimaryBrush}"/>
            <Slider Minimum="{x:Bind ViewModel.MinPrice, Mode=OneWay}"
                   Maximum="{x:Bind ViewModel.MaxPrice, Mode=OneWay}"
                   Value="{x:Bind ViewModel.CurrentMaxPrice, Mode=TwoWay}"
                   TickFrequency="100"
                   TickPlacement="None"
                   Foreground="{StaticResource PrimaryBrush}"/>
          </StackPanel>
        </Border>

        <!-- Category Filter Pills -->
        <Border Background="{StaticResource SurfaceBrush}"
                Padding="{StaticResource SpacingM}"
                CornerRadius="{StaticResource BorderRadiusLarge}"
                BorderThickness="2"
                BorderBrush="{StaticResource BorderBrush}">
          <StackPanel Spacing="{StaticResource SpacingS}">
            <TextBlock Text="Categories"
                       Style="{StaticResource Heading3Style}"
                       Foreground="{StaticResource TextPrimaryBrush}"/>
            <ScrollViewer HorizontalScrollBarVisibility="Auto"
                         VerticalScrollBarVisibility="Disabled"
                         HorizontalScrollMode="Auto">
            <ItemsControl ItemsSource="{x:Bind ViewModel.Categories, Mode=OneWay}">
              <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                  <StackPanel Orientation="Horizontal" Spacing="8"/>
                </ItemsPanelTemplate>
              </ItemsControl.ItemsPanel>
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="x:String">
                  <Button Content="{x:Bind}"
                         Click="CategoryButton_Click"
                         Tag="{x:Bind}"
                           Padding="20,10"
                           CornerRadius="20"
                           MinWidth="80"
                           FontSize="{StaticResource FontSizeSmall}"
                           FontWeight="SemiBold"
                           Background="{StaticResource AcrylicBrush}"
                           BorderThickness="2"
                           BorderBrush="{StaticResource PrimaryBrush}"
                           Foreground="{StaticResource TextPrimaryBrush}"/>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
            </ScrollViewer>
          </StackPanel>
        </Border>

        <!-- Results Count -->
        <TextBlock Style="{StaticResource SecondaryTextStyle}"
                   Margin="0,4,0,0">
          <Run Text="{x:Bind ViewModel.FilteredProducts.Count, Mode=OneWay}"/>
          <Run Text=" products found"/>
        </TextBlock>

      </StackPanel>
    </Border>

    <!-- Products Grid -->
    <ScrollViewer Grid.Row="1" 
                  Padding="{StaticResource SpacingL}"
                  ZoomMode="Disabled"
                  VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Disabled">
      <Grid>
        <!-- Products Grid with Beautiful Card Layout -->
        <ItemsControl ItemsSource="{x:Bind ViewModel.FilteredProducts, Mode=OneWay}"
                      x:Name="ProductsItemsControl">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <ItemsWrapGrid Orientation="Horizontal" 
                            MaximumRowsOrColumns="0"
                            HorizontalAlignment="Stretch"
                            ItemWidth="340"
                            ItemHeight="480"/>
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="models:Product">
              <Border Margin="0,0,16,24"
                     Opacity="0"
                     RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                  <TranslateTransform Y="30"/>
                </Border.RenderTransform>
              <components:ProductCard Product="{x:Bind}"
                                     ViewDetailsCommand="{Binding ViewModel.NavigateToProductDetailCommand, ElementName=PageRoot}"
                                       AddToCartCommand="{Binding ViewModel.AddToCartCommand, ElementName=PageRoot}"/>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Empty State -->
        <Border x:Name="EmptyStateBorder"
                Background="{StaticResource AcrylicBrush}"
                Padding="{StaticResource SpacingXXL}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Center"
                CornerRadius="{StaticResource BorderRadiusLarge}"
                BorderThickness="2"
                BorderBrush="{StaticResource BorderBrush}"
                Visibility="{x:Bind ViewModel.FilteredProducts.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=Inverse}">
          <StackPanel Spacing="{StaticResource SpacingL}" HorizontalAlignment="Center">
            <TextBlock Text="ðŸ”"
                       FontSize="96"
                       HorizontalAlignment="Center"
                       Opacity="0.6"/>
            <TextBlock Text="No products found"
                       Style="{StaticResource Heading2Style}"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="Try adjusting your search or filters to find what you're looking for"
                       Style="{StaticResource SecondaryTextStyle}"
                       HorizontalAlignment="Center"
                       TextAlignment="Center"
                       TextWrapping="Wrap"
                       MaxWidth="400"/>
            <Button Content="Clear Filters"
                   Style="{StaticResource PrimaryButtonStyle}"
                   Margin="0,16,0,0"
                   Command="{x:Bind ViewModel.RefreshCommand}"
                       HorizontalAlignment="Center"/>
          </StackPanel>
        </Border>
      </Grid>
    </ScrollViewer>

    <!-- Loading Overlay -->
    <components:LoadingIndicator Grid.Row="1"
                                IsLoading="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                              Message="Loading products..."/>
  </Grid>
</Page>
